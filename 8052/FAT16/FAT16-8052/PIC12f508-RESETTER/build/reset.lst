gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  1


LOC    OBJECT CODE    LINE  SOURCE TEXT
  VALUE

                      00001 
                      00002 ; PIC12F508 Configuration Bit Settings
                      00003 
                      00004 ; Assembly source line config statements
                      00005 
                      00006 #include "p12f508.inc"
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Aug 07 2014
                      00005 ;  MPASM PIC12F508 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2014 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00158         LIST
                      00007 
                      00008 ; CONFIG
                      00009 ; __config 0xFFFE
0FFF   0FFA           00010  __CONFIG _OSC_IntRC & _WDT_OFF & _CP_OFF & _MCLRE_ON
                      00011  
                      00012  
  00000004            00013 RESET_PIN_8052                  EQU     4   ; pin to reset 8052
  00000005            00014 EA_PIN_8052                     EQU     5   ; pin to enable External Access i.e EA
  00000000            00015 INPUT_SIGNAL_PIN_8052           EQU     0   ;read signal from 8052 to perform reset and enable EA
                      00016 
  00000007            00017 VAR_X   EQU     7
  00000008            00018 VAR_Y   EQU     8
  00000009            00019 VAR_Z   EQU     9
                      00020 
                      00021         
0000                  00022         org 0x00
                      00023         
0000   0A3D           00024         goto setup
                      00025 
                      00026 
0001   0CF9           00027 delayms:        movlw d'249'    ;1us
0002   0027           00028                 movwf VAR_X     ;1us
                      00029                                 ;2us entry
                      00030                 
0003   0000           00031                 nop             ;1us
0004   02E7           00032                 decfsz  VAR_X,F ;1us - except last which is 2us
0005   0A03           00033                 goto $-2        ;2us
                      00034                                 ;total 4us per loop
                      00035                 
0006   0000           00036                 nop             ;1us - compensate last decfsz= 2us/cycles and last goto nt executed;
                      00037                                 ; hence total=3us last loop + 1us this NOP = 4us
                      00038                 
0007   0800           00039                 retlw 0         ;complensate for (249*4us = 996us) + 2us entry = 998us; total= 998us + 2
                            us RETLW = 1000us = 1ms
                      00040 
0008                  00041 delayY:
0008   0901           00042                 call delayms
gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  2


LOC    OBJECT CODE    LINE  SOURCE TEXT
  VALUE

0009   02E8           00043                 decfsz VAR_Y,F
000A   0A08           00044                 goto $-2
000B   0800           00045                 retlw 0
                      00046                 
                      00047                 
                      00048 
000C                  00049 readinput:      ; reads if long or short 0V[low] signal/pulse on INPUT_SIGNAL_PIN_8052
                      00050 
000C   0606           00051                 btfsc GPIO,INPUT_SIGNAL_PIN_8052 ; check PIN0 AS INPUT, skip if clear
000D   0A0C           00052                 goto $-1
                      00053                 
                      00054                 ;debounce 50ms
000E   0C32           00055                 movlw d'50'
000F   0028           00056                 movwf VAR_Y
0010   0901           00057                 call delayms
0011   02E8           00058                 decfsz VAR_Y,F
0012   0A10           00059                 goto $-2
                      00060                 
                      00061                 ; debounce, if signal is less than 50ms
0013   0606           00062                 btfsc GPIO,INPUT_SIGNAL_PIN_8052 ; check PIN0 AS INPUT, skip if clear
0014   0A0C           00063                 goto readinput
                      00064 
                      00065                 ;wait 250ms to detect short or long signal/pulse
0015   0CFA           00066                 movlw d'250'
0016   0028           00067                 movwf VAR_Y
0017   0901           00068                 call delayms
0018   02E8           00069                 decfsz VAR_Y,F
0019   0A17           00070                 goto $-2
                      00071                 
                      00072                 ; detect long signal i.e if still the pin INPUT_SIGNAL_PIN_8052 is pulled low
001A   0606           00073                 btfsc GPIO,INPUT_SIGNAL_PIN_8052
001B   0801           00074                 retlw 1 ; if bit is high (not clear), short signal
001C   0800           00075                 retlw 0 ; if bit still pulled low (clear), long signal
                      00076                 
                      00077                 
001D                  00078 enable_8052_EA: 
001D   0586           00079                 bsf GPIO,RESET_PIN_8052         ; 8052 RESET_PIN high -> trigger reset
                      00080                                                 ; note 8052 reset is ACTIVE HIGH
                      00081                                                 ; and reset signal must be applied 
                      00082                                                 ; for atleast 2 machine cycles
                      00083                                                 ; at 12MHz, 2 machine cycles = 2us
                      00084                 
                      00085         
                      00086                 ; making a 100ms delay -> cant call delayY as stack depth is only 2
001E   0C64           00087                 movlw d'100'
001F   0028           00088                 movwf VAR_Y
0020   0901           00089                 call delayms
0021   02E8           00090                 decfsz VAR_Y,F
0022   0A20           00091                 goto $-2
                      00092                 
                      00093                                                 
0023   04A6           00094                 bcf GPIO,EA_PIN_8052            ;make EA_PIN low -> external access
                      00095                 
gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  3


LOC    OBJECT CODE    LINE  SOURCE TEXT
  VALUE

                      00096         
                      00097                 ; making a 100ms delay -> cant call delayY as stack depth is only 2
0024   0C64           00098                 movlw d'100'
0025   0028           00099                 movwf VAR_Y
0026   0901           00100                 call delayms
0027   02E8           00101                 decfsz VAR_Y,F
0028   0A26           00102                 goto $-2
                      00103                 
0029   0486           00104                 bcf GPIO,RESET_PIN_8052         ; make RESET_PIN low -> stop trigger reset
                      00105                 
002A   0901           00106                 call delayms
                      00107                 
002B   0506           00108                 bsf GPIO,INPUT_SIGNAL_PIN_8052  ; keep pullup on INPUT_SIGNAL_PIN_8052 as
                      00109                                                 ; it might have been affected by the bsf
                      00110                                                 ; read-modify-write command - check Dsheet for more
                      00111                 
002C   0800           00112                 retlw 0
                      00113                 
                      00114                 
002D                  00115 disable_8052_EA:
002D   0586           00116                 bsf GPIO,RESET_PIN_8052         ; 8052 RESET_PIN high -> trigger reset
                      00117                                                 ; note 8052 reset is ACTIVE HIGH
                      00118                                                 ; and reset signal must be applied 
                      00119                                                 ; for atleast 2 machine cycles
                      00120                                                 ; at 12MHz, 2 machine cycles = 2us
                      00121         
                      00122                 ; making a 100ms delay -> cant call delayY as stack depth is only 2
002E   0C64           00123                 movlw d'100'
002F   0028           00124                 movwf VAR_Y
0030   0901           00125                 call delayms
0031   02E8           00126                 decfsz VAR_Y,F
0032   0A30           00127                 goto $-2
                      00128                 
                      00129                                                 
0033   05A6           00130                 bsf GPIO,EA_PIN_8052            ;make EA_PIN high -> internal access    
                      00131 
                      00132         
                      00133                 ; making a 100ms delay -> cant call delayY as stack depth is only 2
0034   0C64           00134                 movlw d'100'
0035   0028           00135                 movwf VAR_Y
0036   0901           00136                 call delayms
0037   02E8           00137                 decfsz VAR_Y,F
0038   0A36           00138                 goto $-2
                      00139                 
0039   0486           00140                 bcf GPIO,RESET_PIN_8052         ; make RESET_PIN low -> stop trigger reset
                      00141                 
003A   0901           00142                 call delayms 
                      00143                 
003B   0506           00144                 bsf GPIO,INPUT_SIGNAL_PIN_8052  ; keep pullup on INPUT_SIGNAL_PIN_8052 as
                      00145                                                 ; it might have been affected by the bsf
                      00146                                                 ; read-modify-write command - check Dsheet for more
                      00147                 
003C   0800           00148                 retlw 0 
gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  4


LOC    OBJECT CODE    LINE  SOURCE TEXT
  VALUE

                      00149                 
                      00150                 
003D                  00151 setup:                  
                      00152                 ;set gpio4 and gpio5 as o/p, gpio0 i/p
003D   0CCF           00153                 movlw b'11001111'               ; make GPIO4,GPIO5 o/p
003E   0006           00154                 tris GPIO                       ; set TRIS for GPIO reg
                      00155 
                      00156 
                      00157                 ;enable pull-ups
003F   0CBF           00158                 movlw b'10111111'
0040   0002           00159                 option
                      00160         
                      00161                 
                      00162                 ;enable pullup on INPUT_SIGNAL_PIN_8052 while  using as input
0041   0506           00163                 bsf GPIO,INPUT_SIGNAL_PIN_8052
                      00164 
0042   092D           00165                 call disable_8052_EA
                      00166                 
                      00167 
                      00168 
                      00169         
0043                  00170 loop:           
0043   090C           00171                 call readinput
                      00172                 
0044   0029           00173                 movwf VAR_Z             ; move return value to VAR_Z
                      00174                 
0045   0609           00175                 btfsc VAR_Z,0           ; if return is 1(short signal/pulse), then run the next line
0046   092D           00176                 call disable_8052_EA    ; if short signal(return is 1) - disable EA, i.e. use Internal R
                            OM 
                      00177                 
0047   0709           00178                 btfss VAR_Z,0           ; if return is 0(long), then run the next line
0048   091D           00179                 call enable_8052_EA     ; if long signal (return is 0)- use External ROM
                      00180 
                      00181                 ;delay 510ms
0049   0CFF           00182                 movlw d'255'
                      00183 
004A   0028           00184                 movwf VAR_Y
004B   0908           00185                 call delayY             ; 255ms delay
                      00186 
004C   0028           00187                 movwf VAR_Y
004D   0908           00188                 call delayY             ; 255ms delay
                      00189                 
                      00190                 
                      00191 
                      00192         
004E   0A43           00193                 goto loop;
                      00194                         
                      00195 
                      00196         end
gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  5


SYMBOL TABLE
  LABEL                             VALUE

C                                 00000000
CAL0                              00000001
CAL1                              00000002
CAL2                              00000003
CAL3                              00000004
CAL4                              00000005
CAL5                              00000006
CAL6                              00000007
DC                                00000001
EA_PIN_8052                       00000005
F                                 00000001
FSR                               00000004
GP0                               00000000
GP1                               00000001
GP2                               00000002
GP3                               00000003
GP4                               00000004
GP5                               00000005
GPIO                              00000006
GPWUF                             00000007
INDF                              00000000
INPUT_SIGNAL_PIN_8052             00000000
NOT_GPPU                          00000006
NOT_GPWU                          00000007
NOT_PD                            00000003
NOT_TO                            00000004
OSCCAL                            00000005
PA0                               00000005
PCL                               00000002
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RESET_PIN_8052                    00000004
STATUS                            00000003
T0CS                              00000005
T0SE                              00000004
TMR0                              00000001
TRISIO0                           00000000
TRISIO1                           00000001
TRISIO2                           00000002
TRISIO3                           00000003
TRISIO4                           00000004
TRISIO5                           00000005
VAR_X                             00000007
VAR_Y                             00000008
VAR_Z                             00000009
W                                 00000000
Z                                 00000002
_CONFIG                           00000FFF
_CP_OFF                           00000FFF
_CP_ON                            00000FF7
_ExtRC_OSC                        00000FFF
gpasm-1.4.0 #1107 (Apr  3 2018)     reset.asm   6-26-2019  21:51:11         PAGE  6


SYMBOL TABLE
  LABEL                             VALUE 

_IDLOC0                           00000200
_IDLOC1                           00000201
_IDLOC2                           00000202
_IDLOC3                           00000203
_IntRC_OSC                        00000FFE
_LP_OSC                           00000FFC
_MCLRE_OFF                        00000FEF
_MCLRE_ON                         00000FFF
_OSC_ExtRC                        00000FFF
_OSC_IntRC                        00000FFE
_OSC_LP                           00000FFC
_OSC_XT                           00000FFD
_WDT_OFF                          00000FFB
_WDT_ON                           00000FFF
_XT_OSC                           00000FFD
__12F508                          00000001
delayY                            00000008
delayms                           00000001
disable_8052_EA                   0000002D
enable_8052_EA                    0000001D
loop                              00000043
readinput                         0000000C
setup                             0000003D


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXX- ---------------- ---------------- ----------------
0FC0 : ---------------- ---------------- ---------------- ---------------X

All other memory blocks unused.

Program Memory Words Used:    79
Program Memory Words Free:   433


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

